# 反向代理

作者：萝莉控的大叔

TID：26182

<title>1</title> <link href="../Styles/Style.css" type="text/css" rel="stylesheet">

# 1

今天尝试了一下造福同好，让大家不要再墙上gn。在尝试反代谷歌成功之后，我微调了一下配置，但是不知为何网站直接重定向了。这里有没有大佬能帮我一下？ <title>2</title> <link href="../Styles/Style.css" type="text/css" rel="stylesheet">

# 2

*本帖最後由 fatih1 於 2018-12-19 04:57 編輯*

Ok 我会帮忙的 love Giantess <title>3</title> <link href="../Styles/Style.css" type="text/css" rel="stylesheet">

# 3

nginx 配置贴下？
& 你代理的测试链接贴下？ <title>4</title> <link href="../Styles/Style.css" type="text/css" rel="stylesheet">

# 4

難道我最近上GN總遇到奇怪的連線問題是你搞出來的嗎(誤 <title>5</title> <link href="../Styles/Style.css" type="text/css" rel="stylesheet">

# 5

> ccccccccccc 發表於 2018-12-20 01:03
> 難道我最近上GN總遇到奇怪的連線問題是你搞出來的嗎(誤

反向代理了解一下（滑稽） <title>6</title> <link href="../Styles/Style.css" type="text/css" rel="stylesheet">

# 6

> b9420 發表於 2018-12-19 23:10
> nginx 配置贴下？
> & 你代理的测试链接贴下？

0
K
Kami Kaze
to me
3 days agoDetails
        server
    {
        listen 80;
        server_name gn.kamikaze.space;
        location / {
              rewrite ^/(.*)$ https://gn.kamikaze.space$1 permanent;
        }
    }

        server
    {
        listen 443;
        server_name gn.kamikaze.space;
        }
        ssl on;
        ssl_certificate /usr/local/nginx/conf/ssl/gn.kamikaze.space.crt;
        ssl_certificate_key /usr/local/nginx/conf/ssl/gn.kamikaze.space.key;

        location / {

                proxy_redirect off;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto https;
                proxy_pass https://www.giantessnight.com;
                proxy_set_header Host "www.giantessnight.com";
                proxy_set_header Accept-Encoding "";
                proxy_set_header User-Agent $http_user_agent;     
        }
    }

拜托了 <title>7</title> <link href="../Styles/Style.css" type="text/css" rel="stylesheet">

# 7

我不是很懂反向代理的配置，不过你可以试试把proxy pass后面的网址结尾打上“/”，([https://www.giantessnight.com/](https://www.giantessnight.com/))，
（还不行试试再把下一行改成proxy_set_header Host $host)

而且你不做镜像的话，全局地址没有办法正确跳转吧。

此外我以前使用反向代理翻墙的体验真的不怎么好……

最近gn的墙似乎松了点，改host已经能比较稳定的连接上了（我的是移动）不用vpn，ssr的话，我个人比较推荐改host的办法

<title>8</title> <link href="../Styles/Style.css" type="text/css" rel="stylesheet">

# 8

我自己测试了下，没问题了，把改好的给你

1.  server {

2.  listen 443;

3.  server_name gn.kamikaze.space;

4.  ssl on;

5.  ssl_certificate /usr/local/nginx/conf/ssl/gn.kamikaze.space.crt;

6.  ssl_certificate_key /usr/local/nginx/conf/ssl/gn.kamikaze.space.key;

7.  gzip on;

9.  location / {

10.  proxy_pass https://giantessnight.com/;

11.  proxy_set_header Host "giantessnight.com";

12.  proxy_set_header User-Agent $http_user_agent;

13.  proxy_set_header X-Real-IP $remote_addr;

14.  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

15.  proxy_set_header X-Forwarded-Proto https;

16.  proxy_set_header Accept-Encoding "";

17.  sub_filter "https://giantessnight.com/" "https://gn.kamikaze.space/";

18.  sub_filter_once off;

19.  proxy_set_header Referer "https://giantessnight.com/";

20.  }

21.  }

*複製代碼*
做了三件事情
1\. 全局替换了内部的链接
2\. 修改了HTTP Referer，绕过Discuz的验证
3\. 和jiko说的一样，改了path

注意因为楼主用了HTTPS所以我就不提HTTPS的事情了，这个方案我试过HTTP是不能用的 <title>9</title> <link href="../Styles/Style.css" type="text/css" rel="stylesheet">

# 9

> [b9420 發表於 2018-12-24 15:19](https://giantessnight.cf/gnforum2012/forum.php?mod=redirect&goto=findpost&pid=392899&ptid=26182)
> 我自己测试了下，没问题了，把改好的给你
> 
> 做了三件事情

那啥，不大懂，现在不是不翻墙上不了 GN 么？
nginx 不也应该跟论坛部署在一起？

这样一来不是照样访问不到 nginx 么？

<title>10</title> <link href="../Styles/Style.css" type="text/css" rel="stylesheet">

# 10

> 乐天 發表於 2018-12-26 21:26
> 那啥，不大懂，现在不是不翻墙上不了 GN 么？
> nginx 不也应该跟论坛部署在一起？

不是的，他用一个没被墙的，而且能访问GN的服务器，就可以用nginx中转了。 <title>11</title> <link href="../Styles/Style.css" type="text/css" rel="stylesheet">

# 11

我用免费翻墙上gn呢，滑稽